const axios = require('axios');
const autocannon = require('autocannon');

const axiosInstance = axios.create({ baseURL: 'http://localhost:5000' });

axiosInstance.interceptors.request.use(req => {
	try {
		req.headers['Content-Type'] = 'application/json';

		return req;
	} catch (error) {
		throw error;
	}
});

axiosInstance.interceptors.response.use(
	response => response?.data,
	error => {
		console.error(error);
	},
);

const create = () => {
	const records = [];

	for (let i = 0; i < 10; i++) {
		records.push({
			cells: {
				'01JCBB1V9TS5SF02BJK2AM7MVY': { data: 'data' },
			},
		});
	}

	return {
		url: 'http://localhost:5000/TBL_3/record/bulk-create/01JBRBE3XNA5FJW30N68A758Y3',
		method: 'POST',
		body: JSON.stringify({ records }),
	};
};

const getList = () => {
	return {
		url: 'http://localhost:5000/TBL_3/record/get-list/01JBRBE3XNA5FJW30N68A758Y3',
		method: 'POST',
		body: JSON.stringify({
			fieldIDs: [
				'01JCBB1V9TS5SF02BJK2AM7MVY',
				'01JCBB42CMDRDKTNDXY6WZPS6E',
				'01JCBB45PV0T7BZWHC0S07WTKS',
				'01JCBB490CMHN09DFZXZAT1Q3G',
				'01JCBB4HCYFZ3A6AR158E8KSNY',
				'01JCBB4RNVSD1GAYQCB46HDM24',
				'01JCBB59JF7EKJA2S7Q3JBJTYG',
				'01JCBB5CYSHKZ3CHH56NKKF23A',
				'01JCBB5KDGFNXSJSJ9QQYPFRJ6',
				'01JCBB5NXNA8062M30QYP5WPTP',
				'01JCBB5R0M6WFW74Z5WRPFSD21',
				'01JCBB5TAPDSAND1YYCDJFZRKH',
				'01JCBB5WZZFHKYC27M32E2XF0M',
				'01JCBB5ZEHT4S6G3NJT66QRY3Y',
				'01JCBB62K65GK8XEBD6SHA3QKB',
				'01JCBB69MMERNB6HFF5SPQ5MNV',
				'01JCBB6D2CHNJ4805P6QC1GPPN',
				'01JCBB6G9DWZH8RYGVZWMH5980',
				'01JCBB6KM5PPQ22433XZ51RGRN',
				'01JCBB6PJR3YGVED8R4MJCAEWH',
				'01JCBB9Z3PR09EZ7KDDT0MSXHF',
				'01JCBBA7ERE0PK7J1F6BRXPZ32',
				'01JCBBAARW6HDMCYE4A4JN5FJ1',
				'01JCBBAD9NNCFSK9AR38T35W68',
				'01JCBBAGVVE0TT3XDGKXKHSWV9',
				'01JCBBANVJBFRCHC12M1F0MZ3Q',
				'01JCBBARC89S8XZX3C50Q2TYFJ',
				'01JCBBAWYDAD6E607JV8JPNFKZ',
				'01JCBBB16EDPAXWD7Z0AJ0V5F0',
				'01JCBBB357NKKK83D02NC7B2SD',
				'01JCBBB89YSQ1FMW4MHYHWBPHQ',
				'01JCBBBBFG9QTV2ABBMT7T8FXH',
				'01JCBBBD8S3FDZNX9RT2FCRXBP',
				'01JCBBDDA1PHKP9CV8XV0JF2AQ',
				'01JCBBDFJZ3EEXTYFXG9K0Z1CE',
				'01JCBBDHP99HP5S2EG0SAK1S13',
				'01JCBBDKY4K9HBKVWDBBH06J1A',
				'01JCBBDQMSA3P6D6PP5JS4KXVA',
				'01JCBBDTQN4P85RR5SCH1SKMBM',
				'01JCBBDXP3HDJSMNQDE83VG53Q',
				'01JCBBE0AKS4YRRXEB5JYYPFR2',
				'01JCBBE2MFA088QH8P1KSPND3E',
				'01JCBBE5C8K7HTCSCYWHHTARV6',
				'01JCBBE85NRM8S1E5HFQP8S8TM',
				'01JCBBEAVR7B088HGPGMDE06ZN',
				'01JCBBEDDD98D56VVBZNPSHVGE',
				'01JCBBEG33Z6MSFRNQ5TWRV29T',
				'01JCBBEJT6705Y476QBW358C3W',
				'01JCBBENMFG2FK4W20GDFDC94Z',
				'01JCBBETCAXNFF2TA661FT0H8J',
				'01JCBBFCC72RKKSKJ5HGH6A6W6',
				'01JCBBFEWHB818HAP30ZMKA5ZC',
				'01JCBBFHYBW0TH29ZDQRZJEJXN',
				'01JCBBFMZ7E3RD2DZ3BNCSDMFQ',
				'01JCBBFX5K4QFGVRVH9T8ZBHZV',
				'01JCBBFZTZN1ANFQB1J9Q1QMKH',
				'01JCBBGCC1M3T9R5P00R1PJ1A8',
				'01JCBBGFFEANG6YNVAPGV5VQP0',
				'01JCBBHPYWYR35ZF94FCVD9G8Q',
				'01JCBBJ9QWDH0RAC2JTTQ6T4KG',
				'01JCBBJCQ7X1DSHDVKS4A11GA2',
				'01JCBBJFFMMH0TVA7NSXV864GN',
				'01JCBBJJ3SBNJ6YADJY8WA7MK6',
				'01JCBBJMJBTX0A7YNN0GTJGSY1',
				'01JCBBJPY79V9SEP3QV4WPSVJB',
				'01JCBBJS986DC35GV7KNGY4V3R',
				'01JCBBJVQ9MJ9P77KPV3FRBRNG',
				'01JCBBJXS7DPDC2EY352ZG8QGZ',
				'01JCBBJZZ7CDGQVS0E9D9BCC2T',
				'01JCBBK27CHRFEE3D3KP3T98C1',
				'01JCBBK58M6SV70WXGSHJWBXAW',
				'01JCBBK8EHV17G7Q8C8JRVJMCV',
				'01JCBBKGZYBJB1FK1Q83HQ30YJ',
				'01JCBBKM11GPTD5ZV1TG0XJ5HS',
				'01JCBBKQ3XGDQEDEJZT3Q130T7',
				'01JCBBKT9A74WDT3BQJSA67TJ4',
				'01JCBBKX68KVK28N0YNPFKKJCZ',
				'01JCBBM0CSV6WPWDZ2TPX3JA5W',
				'01JCBBM37B077FV7V56NAZ8E5N',
				'01JCBBM5Z7MJ3VJ7NVHEN1C1KM',
				'01JCBBM8N4SHT744Q61T79NEJE',
				'01JCBBMBK47FKA7Q1X3PJYMTDT',
				'01JCBBMDQCGVH79AHECADD3022',
				'01JCBBMFZMCK94T0JVNJ2W7RES',
				'01JCBBMJ3ER0R334705BV5H9DJ',
				'01JCBBMMM2YZE3EQPC0NGG8NGD',
				'01JCBBMPVA00GA5F23XXB2B5W2',
				'01JCBBMRYKJSHHPDCM7ZT13FSF',
				'01JCBBMVQ30EDGBPFQAFQH8YCA',
				'01JCBBMYQH5H5D5G8BVB0ETPMQ',
				'01JCBBN1AN26X3NVQXCQ0P6BD4',
				'01JCBBN4HPJYQ2GJHXQ3CJZWY0',
				'01JCBBNB79K5K3MG5DDEK13GAQ',
				'01JCBBNDW7EEJKHYSS10MVNEVZ',
				'01JCBBNGPFBCKWZ4RXV2TQP33B',
				'01JCBBNM9QJTW1X0T3ZJ0VTAPM',
				'01JCBBNPQ5S3JS0CM7C203P6HV',
				'01JCBBNS6P7T8MZQ8N71AXJJDY',
				'01JCBBP00PR467ETWVN9MMR0DM',
				'01JCBBP73MRTMCTP4MYMWMSJBF',
			],
			limit: 10000,
			offset: 0,
		}),
	};
};

const instance = autocannon(
	Object.assign({
		connections: 100, //default
		pipelining: 1, // default
		duration: 10, // default
		timeout: 300000,
		headers: {
			'Content-Type': 'application/json',
			workspaceID: 'ws1',
		},
		// ...create(),
		...getList(),
	}),
);

autocannon.track(instance);

process.once('SIGINT', () => {
	instance.stop();
});
